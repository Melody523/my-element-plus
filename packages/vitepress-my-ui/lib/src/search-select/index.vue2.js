"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const c=require("vue"),b=require("../utils/utils.js"),A=c.defineComponent({name:"SearchSelect",emits:["update:modelValue","onDialogShow","onSearchClear","change","custDialog"],props:{modelValue:{type:Array||Object},ruleModel:{type:String,default:""},disabled:{type:Boolean,default:!1},rowKey:{type:String,default:"id"},initMultiple:{type:Boolean,default:!0},searchBy:{type:String,default:""},catchValue:{type:Array,default:()=>["id","code","name"]},initItem:{type:Object,default:()=>({})},checkTable:{type:Array,default:()=>[]},labelFormat:{type:[Array,Function],default:[]},catchValueAll:{type:Boolean,default:!1},fetchUrl:{type:Function},renderFunc:{type:Function,default:e=>e},dealFetchFunc:{type:Function,default:e=>e},params:{type:Object,default:{}},initialDataSource:{type:Array,default:()=>[]},pagination:{type:Object,default:{currentPage:1,pageSize:15}}},setup(e,{emit:r}){let l=c.reactive({inputValue:[],loading:!1,options:[],query:""});const h=t=>{let a=e.initMultiple?t:t?[t]:[];r("update:modelValue",a),r("custDialog",{list:a},e.initItem.key)},f=(t,a=!1,i=!1)=>{let n=[];t&&t.length>0&&(n=[...t]),a&&(e.initMultiple?n=[...l.inputValue,...n]:l.inputValue&&Object.keys(l.inputValue).length>0&&(n=[l.inputValue,...n])),i&&(n=[...n,...l.options.map(u=>u.value)]),l.options=s(n.map(u=>y(u)))},g=()=>({...e.pagination,...e.params}),S=(t,a=!1)=>{e.fetchUrl&&(t||a)&&(l.query=t,l.loading=!0,e.fetchUrl(e.dealFetchFunc(g())).then(i=>{if(t===l.query){const{data:n}=e.renderFunc(i);f(n,!0,!1)}}).catch(i=>{console.log("onSearch catch",i),f([],!1,!1)}).finally(()=>{l.loading=!1}))},V=(t,a)=>{r("onDialogShow",t,a)},s=t=>{const a=new Map;return t.filter(n=>!a.has(n[e.rowKey])&&a.set(n[e.rowKey],1))},y=t=>{var u;let a={};e.catchValueAll?a={...t}:((u=e.catchValue)==null?void 0:u.length)>0&&e.catchValue.forEach(o=>{a[o]=t[o]});let i=o=>{var d,m;return typeof e.labelFormat=="function"?e.labelFormat(o):typeof e.labelFormat=="object"&&((d=e.labelFormat)==null?void 0:d.length)>0?(m=e.labelFormat)==null?void 0:m.map(F=>t==null?void 0:t[F]).join(" "):o==null?void 0:o[e.searchBy]};const n={[e.rowKey]:t[e.rowKey],label:i(t),value:Object.keys(a).length>0?{...a}:{code:t.code,name:t.name,id:t.id}};return b.deepClone(n)};c.watch(()=>e.modelValue,t=>{var i,n,u;if(!Array.isArray(t)&&((i=e.initItem)!=null&&i.useCheckTable&&!t||!((n=e.initItem)!=null&&n.useCheckTable))){r("update:modelValue",[]);return}let a=(u=e.initItem)!=null&&u.useCheckTable?e==null?void 0:e.checkTable:t;a&&(a!=null&&a.length)&&Array.isArray(a)?(l.inputValue=e.initMultiple?a:a[0],f(a,!1,!0),r("change",a)):(l.inputValue=e.initMultiple?[]:"",f([],!1,!1),r("change",[]))},{deep:!0,immediate:!0});const w=(t,a,i)=>{h(e.initMultiple?[]:""),r("onSearchClear",t,a,i)};return c.watchEffect(()=>{var t;!e.fetchUrl&&((t=e.initialDataSource)==null?void 0:t.length)>0&&f(e.initialDataSource,!0,!1)}),{...c.toRefs(l),...c.toRefs(e),onSearch:S,onSelect:h,controlOptions:y,deleteRepeat:s,onDialogShow:V,onSearchClear:w}},components:{InputAndButoon:c.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../input-and-button/index.vue.js"))),SvgIcon:c.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../icon/index.vue.js")))}});exports.default=A;
