"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const o=require("vue"),u=require("../utils/utils.js");let v={};const k=o.defineComponent({name:"Selection",emits:["update:modelValue","custHandle"],props:{modelValue:{type:Boolean,default:!1},selectKey:{type:String,default:""},title:{type:String,default:""},showFormList:{type:Object,default:{code:{key:"code",label:"编码",isShow:!0,type:"input"},name:{key:"name",label:"名称",isShow:!0,type:"input"}}},showTableList:{type:Object,default:{code:{key:"code",label:"编码",isShow:!0},name:{key:"name",label:"名称",isShow:!0}}},isRadio:{type:Boolean,default:!0},checkTable:{type:Array,default:[]},rowKey:{type:String,default:"id"},confirmClose:{type:Boolean,default:!0},fetchUrl:{type:Function},renderFunc:{type:Function,default:a=>a},dealFetchFunc:{type:Function,default:a=>a},params:{type:Object,default:{}}},setup(a,{emit:r}){const{hooksCommonState:l,currentChange:g,sizeChange:h}=u.getCommonState(),t=o.reactive({formList:[],formListBackup:[],tableList:[],tableListBackup:[],form:{},tableData:[],selectTableData:[],searchFormRef:o.ref(null),multipleTable:o.ref(null),dialogWidth:920,extendAttributes:[],disabledId:"",dialogTop:"8vh",activeName:"first",dialogRef:o.ref("")}),y=e=>{e==="confirm"?(r("custHandle",{visible:!1,list:t.selectTableData||[],type:a.selectKey}),a.confirmClose&&(r("update:modelValue",!1),t.multipleTable.clearSelection(),t.form={})):(r("update:modelValue",!1),t.multipleTable.clearSelection(),t.form={})},p=e=>{a.isRadio?(e&&Object.keys(e).length>0&&(r("custHandle",{visible:!1,list:[e]||[],rowData:e,type:a.selectKey}),r("update:modelValue",!1),t.selectTableData=[],t.multipleTable.clearSelection()),t.form={}):t.multipleTable.toggleRowSelection(e)},S=e=>{t.selectTableData=e},T=e=>{t.multipleTable.toggleRowSelection(t.multipleTable.getSelectionRows().find(i=>i[a.rowKey]==e[a.rowKey]),!1),t.selectTableData=t.selectTableData.filter(i=>i[a.rowKey]!==e[a.rowKey])},d=()=>{l.pager.currentPage=1,f()},L=()=>{t.form={},d()},f=async()=>{if(a.fetchUrl)try{let e=u.deepClone(t.form);l.tableLoading=!0;const i=l.pager.currentPage,c=l.pager.pageSize;t.formList.filter(n=>n.type==="modalTextarea").map(n=>{e[n.key]&&(e[n.key]=t.form[n.key].split(","))}),a.fetchUrl(a.dealFetchFunc({currentPage:i,pageSize:c,...a.params,...e})).then(n=>{const{data:s,count:m}=a.renderFunc(n);t.tableData=s,l.tableLoading=!1,l.pager.total=m})}catch(e){t.tableData=[],l.pager.total=0,console.log("%c error","color: chartreuse",e),l.tableLoading=!1}},w=e=>{e==null||e.forEach(i=>{t.multipleTable.toggleRowSelection(i)}),t.selectTableData=e},b=(e,i)=>{var n;let c=[];return(n=Object.keys(e))==null||n.map(s=>{if(typeof e[s]=="boolean"&&e[s]){let m=i.find(D=>D.key==s)||[];c.push({...m,isShow:!0})}else typeof e[s]=="object"&&c.push({isShow:!0,...e[s]})}),c},F=()=>{t.activeName="first";const e=a.checkTable;e.length>0&&w(e),f(),t.tableData=[],l.pager.currentPage=1,l.pager.total=0},C=()=>{t.activeName="first"};return o.watch(()=>a.showFormList,()=>{t.formList=u.deepClone(b(a.showFormList,t.formListBackup)),t.formList.filter(e=>e.isShow).map(e=>{t.form[e.key]=""})},{immediate:!0}),o.watch(()=>a.showTableList,()=>{t.tableList=u.deepClone(b(a.showTableList,t.tableListBackup))},{immediate:!0}),{...o.toRefs(t),...o.toRefs(l),staticData:v,handleClose:y,getData:f,resetInfo:L,handleOpen:F,currentChange:g,sizeChange:h,searchData:d,handleSelectionChange:S,removeSelectData:T,rowClick:p,toFirstTab:C}},components:{SearchForm:o.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../search-form/index.vue.js"))),ThePagination:o.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../the-pagination/index.vue.js")))}});exports.default=k;
