"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("vue"),u=require("../utils/utils.js"),F=s.defineComponent({name:"RCForm",emits:["onDialogShow","onSearchClear","custDialog","inputEnter","update:modelValue"],props:{modelValue:{type:Object,default:()=>({})},formList:{type:Array,default:()=>[]},rowNumber:{type:Number,default:3},hasToolsCol:{type:Boolean,default:!1},show:{type:Boolean,default:!0},staticData:{type:Object,default:()=>{}},labelWidth:{type:String,default:"100px"},formRules:{type:Object,default:()=>({})},fetchUrl:{type:Function},params:{type:Object,default:()=>{}},renderFunc:{type:Function,default:r=>r},titleType:{type:String,default:""}},setup(r,{emit:f}){const{globalProperties:y}=u.useCurrentInstance();let a=s.reactive({form:{},formRef:s.ref(null),onChangeFlag:!1});const h=(e,t)=>{var o;let n=e;if(t.textFormat)return t.textFormat(e,a.form);if((t!=null&&t.options||(o=r==null?void 0:r.staticData)!=null&&o[t.key])&&(n=b(e,t.options||r.staticData[t.key],t.type==="textWith")),t.type==="textDate"){const l=p(e,t.format);l!=="Invalid Date"&&(n=l)}if(["textList","textCascader","textJoin"].includes(t.type)){let l=",",c="";switch(t.type){case"textList":l=",",c="name";break;case"textCascader":l=" / ",c="";break;default:l=(t==null?void 0:t.joinStr)||",",c=(t==null?void 0:t.joinTarget)||"";break}e&&Array.isArray(e)&&e.length>0?n=e==null?void 0:e.map(i=>c?i==null?void 0:i[c]:i).join(l):n=""}return n},b=(e,t,n=!1)=>{let o;return t&&Array.isArray(t)&&(o=t.find(l=>l.value===e)),o&&(n?`【${o==null?void 0:o.value}-${o==null?void 0:o.name}】`:(o==null?void 0:o.name)||(o==null?void 0:o.label))||e},p=(e,t)=>{try{return y.dayjs(e).format(t||"YYYY-MM-DD")}catch{return e}},C=s.computed(()=>r.formList.filter(e=>e.isShow).slice(0,r.rowNumber-1)),S=e=>r.show?e.isShow:C.value.findIndex(t=>t.key===e.key)>-1,D=(e,t={})=>{f("onDialogShow",e,t)},w=(e,t)=>{f("custDialog",e,t)},m=(e,t,n)=>{if(e){const o=u.deepClone(a.form);Object.keys({...e,key:t}).map(l=>{var c;o[l]=e[l],(c=o==null?void 0:o.checkTable)!=null&&c.hasOwnProperty(l)&&(o.checkTable[l]=[])}),a.form=o}n&&n(),f("onSearchClear",e,t,n)},x=e=>{const t=u.deepClone(e);return Object.keys(e).forEach(n=>{Array.isArray(e[n])&&e[n].length===0&&delete t[n]}),t},j=()=>new Promise((e,t)=>{try{a.formRef.validate((n,o)=>{n?e(x(u.getNotEmptyObject(a.form))):(console.log("form",o),t(o))})}catch(n){console.log("catch",n),t(n)}});a.form=s.computed({get:()=>r.modelValue,set:e=>f("update:modelValue",e)});const d=async()=>{try{if(r.fetchUrl){const e=await r.fetchUrl(r.params);a.form=r.renderFunc(e||{})}}catch(e){console.log(e,"error")}};r.fetchUrl&&d();const A=s.computed(()=>r.formList.findIndex(e=>e.contant)),k=()=>{f("inputEnter")},v=e=>{e.selectClear?e.selectClear():delete a.form[e.key]};return{...s.toRefs(a),showList:S,onDialogShow:D,onSearchClear:m,submit:j,getText:h,keyUpEnter:k,custDialog:w,isEmpty:u.isEmpty,firstDetailTitleIndex:A,getData:d,clearSelect:v}},components:{SearchNumberList:s.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../search-number-list/index.vue.js"))),DigitalRange:s.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../digital-range/index.vue.js"))),DatePicker:s.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../date-picker/index.vue.js"))),BasicSelectModal:s.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../basic-select-modal/index.vue.js"))),SearchSelect:s.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../search-select/index.vue.js")))}});exports.default=F;
