"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("vue"),f=require("../utils/utils.js"),A=a.defineComponent({name:"RCForm",emits:["onDialogShow","onSearchClear","custDialog","inputEnter","update:modelValue"],props:{modelValue:{type:Object,default:()=>({})},formList:{type:Array,default:()=>[]},rowNumber:{type:Number,default:3},hasToolsCol:{type:Boolean,default:!1},show:{type:Boolean,default:!0},staticData:{type:Object,default:()=>{}},labelWidth:{type:String,default:"100px"},formRules:{type:Object,default:()=>({})},initForm:{type:Object,default:()=>({})},formItemMrgb:{type:Number,default:null},extendAttrUrl:{type:String,default:""},fetchUrl:{type:Function},params:{type:Object,default:()=>{}},renderFunc:{type:Function,default:o=>o},callbackFunc:{type:Function||null,default:null},titleType:{type:String,default:""}},setup(o,{emit:u}){const{globalProperties:y}=f.useCurrentInstance();let c=a.reactive({form:{},formRef:a.ref(null),onChangeFlag:!1});const h=(e,t)=>{var n;let r=e;if(t.textFormat)return t.textFormat(e,c.form);if((t!=null&&t.options||(n=o==null?void 0:o.staticData)!=null&&n[t.key])&&(r=b(e,t.options||o.staticData[t.key],t.type==="textWith")),t.type==="textDate"){const l=m(e,t.format);l!=="Invalid Date"&&(r=l)}if(["textList","textCascader","textJoin"].includes(t.type)){let l=",",s="";switch(t.type){case"textList":l=",",s="name";break;case"textCascader":l=" / ",s="";break;default:l=(t==null?void 0:t.joinStr)||",",s=(t==null?void 0:t.joinTarget)||"";break}e&&Array.isArray(e)&&e.length>0?r=e==null?void 0:e.map(i=>s?i==null?void 0:i[s]:i).join(l):r=""}return r},b=(e,t,r=!1)=>{let n;return t&&Array.isArray(t)&&(n=t.find(l=>l.value===e)),n&&(r?`【${n==null?void 0:n.value}-${n==null?void 0:n.name}】`:(n==null?void 0:n.name)||(n==null?void 0:n.label))||e},m=(e,t)=>{try{return y.dayjs(e).format(t||"YYYY-MM-DD")}catch{return e}},S=a.computed(()=>o.formList.filter(e=>e.isShow).slice(0,o.rowNumber-1)),C=e=>o.show?e.isShow:S.value.findIndex(t=>t.key===e.key)>-1,D=(e,t={})=>{u("onDialogShow",e,t)},F=(e,t)=>{u("custDialog",e,t)},w=(e,t,r)=>{if(e){const n=f.deepClone(c.form);Object.keys({...e,key:t}).map(l=>{var s;n[l]=e[l],(s=n==null?void 0:n.checkTable)!=null&&s.hasOwnProperty(l)&&(n.checkTable[l]=[])}),c.form=n}r&&r(),u("onSearchClear",{key:t})},j=e=>{const t=f.deepClone(e);return Object.keys(e).forEach(r=>{Array.isArray(e[r])&&e[r].length===0&&delete t[r]}),t},k=()=>new Promise((e,t)=>{try{c.formRef.validate((r,n)=>{r?e(j(f.getNotEmptyObject(c.form))):(console.log("form",n),t(n))})}catch(r){console.log("catch",r),t(r)}});c.form=a.computed({get:()=>o.modelValue,set:e=>u("update:modelValue",e)});const d=async()=>{try{if(o.fetchUrl){const e=await o.fetchUrl(o.params);c.form=o.renderFunc(e||{}),o.callbackFunc&&o.callbackFunc(e||{})}}catch(e){console.log(e,"error")}};o.fetchUrl&&d(),a.watchEffect(()=>{var e;!o.fetchUrl&&o.initForm&&((e=Object.keys(o.initForm))==null?void 0:e.length)>0&&(c.form={...o.initForm})});const x=a.computed(()=>o.formList.findIndex(e=>e.contant)),p=()=>{u("inputEnter")};return{...a.toRefs(c),showList:C,onDialogShow:D,onSearchClear:w,submit:k,getText:h,keyUpEnter:p,custDialog:F,isEmpty:f.isEmpty,firstDetailTitleIndex:x,getData:d}},components:{SearchNumberList:a.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../search-number-list/index.vue.js"))),DigitalRange:a.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../digital-range/index.vue.js"))),DatePicker:a.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../date-picker/index.vue.js"))),BasicSelectModal:a.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../basic-select-modal/index.vue.js"))),SearchSelect:a.defineAsyncComponent(()=>Promise.resolve().then(()=>require("../search-select/index.vue.js")))}});exports.default=A;
